<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badminton Tournament Manager v2.0.3-MATERIAL-FIXED</title>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Material 3 Web Components -->
    <script type="module">
        console.log('üîß Loading Material 3 Web Components...');
        
        // More robust double loading prevention
        if (!window.materialComponentsLoaded && !window.materialComponentsLoading) {
            window.materialComponentsLoading = true;
            
            try {
                // Check if components are already registered
                const componentsToLoad = [
                    { name: 'md-dialog', url: 'https://esm.run/@material/web@1.3.0/dialog/dialog.js' },
                    { name: 'md-filled-button', url: 'https://esm.run/@material/web@1.3.0/button/filled-button.js' },
                    { name: 'md-text-button', url: 'https://esm.run/@material/web@1.3.0/button/text-button.js' },
                    { name: 'md-outlined-button', url: 'https://esm.run/@material/web@1.3.0/button/outlined-button.js' },
                    { name: 'md-icon-button', url: 'https://esm.run/@material/web@1.3.0/iconbutton/icon-button.js' },
                    { name: 'md-icon', url: 'https://esm.run/@material/web@1.3.0/icon/icon.js' },
                    { name: 'md-tabs', url: 'https://esm.run/@material/web@1.3.0/tabs/tabs.js' },
                    { name: 'md-primary-tab', url: 'https://esm.run/@material/web@1.3.0/tabs/primary-tab.js' },
                    { name: 'md-outlined-text-field', url: 'https://esm.run/@material/web@1.3.0/textfield/outlined-text-field.js' },
                    { name: 'md-chip-set', url: 'https://esm.run/@material/web@1.3.0/chips/chip-set.js' },
                    { name: 'md-suggestion-chip', url: 'https://esm.run/@material/web@1.3.0/chips/suggestion-chip.js' },
                    { name: 'md-circular-progress', url: 'https://esm.run/@material/web@1.3.0/progress/circular-progress.js' }
                ];
                
                const loadPromises = [];
                
                for (const component of componentsToLoad) {
                    if (!customElements.get(component.name)) {
                        console.log(`üîÑ Loading ${component.name}...`);
                        loadPromises.push(import(component.url));
                    } else {
                        console.log(`‚úÖ ${component.name} already registered`);
                    }
                }
                
                if (loadPromises.length > 0) {
                    await Promise.all(loadPromises);
                    console.log(`‚úÖ ${loadPromises.length} Material 3 components loaded successfully`);
                } else {
                    console.log('‚úÖ All Material 3 components already loaded');
                }
                
                window.materialComponentsLoaded = true;
                window.materialComponentsLoading = false;
                
                // Wait a bit and check if components are properly defined
                setTimeout(() => {
                    console.log('üîç Checking Material 3 component definitions...');
                    const criticalComponents = ['md-tabs', 'md-primary-tab', 'md-outlined-text-field', 'md-filled-button'];
                    const missingComponents = criticalComponents.filter(name => !customElements.get(name));
                    
                    if (missingComponents.length > 0) {
                        console.warn('‚ö†Ô∏è Some critical components not defined:', missingComponents);
                        console.log('üîß Applying fallback styling for missing components...');
                        
                        // Add fallback class to body to trigger fallback CSS
                        document.body.classList.add('material-fallback');
                    } else {
                        console.log('‚úÖ All critical Material 3 components properly defined');
                    }
                }, 1000);
                
            } catch (error) {
                console.warn('‚ö†Ô∏è Some Material 3 components failed to load:', error.message);
                console.log('‚úÖ Continuing with available components...');
                window.materialComponentsLoading = false;
                
                // Apply fallback styling
                document.body.classList.add('material-fallback');
            }
        } else if (window.materialComponentsLoading) {
            console.log('‚è≥ Material 3 components are currently loading...');
        } else {
            console.log('‚úÖ Material 3 components already loaded');
        }
    </script>
    
    <!-- Material 3 Design Tokens -->
    <style>
        :root {
            /* Material 3 Light Theme */
            --md-sys-color-primary: #6750a4;
            --md-sys-color-on-primary: #ffffff;
            --md-sys-color-primary-container: #eaddff;
            --md-sys-color-on-primary-container: #21005d;
            
            --md-sys-color-secondary: #625b71;
            --md-sys-color-on-secondary: #ffffff;
            --md-sys-color-secondary-container: #e8def8;
            --md-sys-color-on-secondary-container: #1d192b;
            
            --md-sys-color-tertiary: #7d5260;
            --md-sys-color-on-tertiary: #ffffff;
            --md-sys-color-tertiary-container: #ffd8e4;
            --md-sys-color-on-tertiary-container: #31111d;
            
            --md-sys-color-error: #ba1a1a;
            --md-sys-color-on-error: #ffffff;
            --md-sys-color-error-container: #ffdad6;
            --md-sys-color-on-error-container: #410002;
            
            --md-sys-color-background: #fffbfe;
            --md-sys-color-on-background: #1c1b1f;
            --md-sys-color-surface: #fffbfe;
            --md-sys-color-on-surface: #1c1b1f;
            --md-sys-color-surface-variant: #e7e0ec;
            --md-sys-color-on-surface-variant: #49454f;
            
            --md-sys-color-outline: #79747e;
            --md-sys-color-outline-variant: #cab6c7;
            --md-sys-color-surface-container-lowest: #ffffff;
            --md-sys-color-surface-container-low: #f7f2fa;
            --md-sys-color-surface-container: #f3edf7;
            --md-sys-color-surface-container-high: #ece6f0;
            --md-sys-color-surface-container-highest: #e6e0e9;
            
            --md-sys-color-inverse-surface: #313033;
            --md-sys-color-inverse-on-surface: #f4eff4;
            --md-sys-color-inverse-primary: #d0bcff;
            
            --md-sys-color-surface-dim: #ded8e1;
            --md-sys-color-surface-bright: #fffbfe;
            
            /* Elevation */
            --md-sys-elevation-1: 0px 1px 3px rgba(0,0,0,0.12), 0px 1px 2px rgba(0,0,0,0.24);
            --md-sys-elevation-2: 0px 3px 6px rgba(0,0,0,0.16), 0px 3px 6px rgba(0,0,0,0.23);
            --md-sys-elevation-3: 0px 10px 20px rgba(0,0,0,0.19), 0px 6px 6px rgba(0,0,0,0.23);
        }
        
        /* Dark theme support */
        @media (prefers-color-scheme: dark) {
            :root {
                --md-sys-color-primary: #d0bcff;
                --md-sys-color-on-primary: #381e72;
                --md-sys-color-primary-container: #4f378b;
                --md-sys-color-on-primary-container: #eaddff;
                
                --md-sys-color-secondary: #ccc2dc;
                --md-sys-color-on-secondary: #332d41;
                --md-sys-color-secondary-container: #4a4458;
                --md-sys-color-on-secondary-container: #e8def8;
                
                --md-sys-color-tertiary: #efb8c8;
                --md-sys-color-on-tertiary: #492532;
                --md-sys-color-tertiary-container: #633b48;
                --md-sys-color-on-tertiary-container: #ffd8e4;
                
                --md-sys-color-error: #ffb4ab;
                --md-sys-color-on-error: #690005;
                --md-sys-color-error-container: #93000a;
                --md-sys-color-on-error-container: #ffdad6;
                
                --md-sys-color-background: #10101a;
                --md-sys-color-on-background: #e6e0e9;
                --md-sys-color-surface: #10101a;
                --md-sys-color-on-surface: #e6e0e9;
                --md-sys-color-surface-variant: #49454f;
                --md-sys-color-on-surface-variant: #cab6c7;
                
                --md-sys-color-outline: #938f99;
                --md-sys-color-outline-variant: #49454f;
                --md-sys-color-surface-container-lowest: #0b0b14;
                --md-sys-color-surface-container-low: #1c1b1f;
                --md-sys-color-surface-container: #201f23;
                --md-sys-color-surface-container-high: #2b2930;
                --md-sys-color-surface-container-highest: #36343b;
                
                --md-sys-color-inverse-surface: #e6e0e9;
                --md-sys-color-inverse-on-surface: #313033;
                --md-sys-color-inverse-primary: #6750a4;
                
                --md-sys-color-surface-dim: #10101a;
                --md-sys-color-surface-bright: #3b383e;
            }
        }

        /* Basic app styling without Material Web Components */
        body {
            font-family: 'Roboto', Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--md-sys-color-background);
            color: var(--md-sys-color-on-background);
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .app-header {
            background: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .app-icon {
            font-size: 32px;
        }

        .headline-medium {
            font-size: 28px;
            font-weight: 500;
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .icon-button {
            background: transparent;
            border: none;
            color: inherit;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            transition: background-color 0.2s;
        }

        .icon-button:hover {
            background: rgba(255,255,255,0.1);
        }

        .app-navigation {
            background: var(--md-sys-color-surface);
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
        }

        .nav-tabs {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-tab {
            background: transparent;
            border: none;
            padding: 16px 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--md-sys-color-on-surface);
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .nav-tab:hover {
            background: var(--md-sys-color-surface-container);
        }

        .nav-tab.active {
            color: var(--md-sys-color-primary);
            border-bottom-color: var(--md-sys-color-primary);
        }

        .main-content {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
            width: 100%;
            box-sizing: border-box;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .card {
            background: var(--md-sys-color-surface-container-low);
            border-radius: 12px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .button {
            background: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: all 0.2s;
        }

        .button:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .button-outlined {
            background: transparent;
            color: var(--md-sys-color-primary);
            border: 1px solid var(--md-sys-color-outline);
        }

        .text-field {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 8px;
            background: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            font-size: 16px;
            margin: 8px 0;
            box-sizing: border-box;
        }

        .text-field:focus {
            outline: 2px solid var(--md-sys-color-primary);
            border-color: transparent;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--md-sys-color-on-surface-variant);
        }
        
        /* Material Icons Fix */
        .material-icons,
        md-icon {
            font-family: 'Material Icons' !important;
            font-weight: normal !important;
            font-style: normal !important;
            font-size: 24px !important;
            line-height: 1 !important;
            letter-spacing: normal !important;
            text-transform: none !important;
            display: inline-block !important;
            white-space: nowrap !important;
            word-wrap: normal !important;
            direction: ltr !important;
            font-feature-settings: 'liga' !important;
            -webkit-font-feature-settings: 'liga' !important;
            -webkit-font-smoothing: antialiased !important;
        }
        
        /* Force Material 3 components to show */
        md-icon-button,
        md-filled-button,
        md-outlined-button,
        md-text-button,
        md-tabs,
        md-primary-tab,
        md-dialog,
        md-outlined-text-field,
        md-filled-text-field,
        md-circular-progress,
        md-chip-set,
        md-assist-chip {
            display: inline-flex !important;
            font-family: 'Roboto', sans-serif !important;
        }
        
        /* Text field specific fixes */
        md-outlined-text-field,
        md-filled-text-field {
            width: 100% !important;
            min-width: 200px !important;
            opacity: 1 !important;
            visibility: visible !important;
            position: relative !important;
            z-index: 1 !important;
        }
        
        /* Button alignment fixes */
        md-filled-button,
        md-outlined-button,
        md-text-button {
            align-items: center !important;
            justify-content: center !important;
            min-height: 40px !important;
            opacity: 1 !important;
            visibility: visible !important;
            position: relative !important;
            z-index: 1 !important;
        }
        
        /* Tabs styling */
        md-tabs {
            width: 100% !important;
            flex-direction: row !important;
            justify-content: center !important;
            align-items: center !important;
        }
        
        md-primary-tab {
            flex: 1 !important;
            align-items: center !important;
            justify-content: center !important;
            text-align: center !important;
            display: flex !important;
            flex-direction: column !important;
            gap: 4px !important;
        }
        
        /* Force tabs container to be visible */
        .app-navigation md-tabs {
            width: 100% !important;
            display: flex !important;
            background: var(--md-sys-color-surface) !important;
            border-bottom: 1px solid var(--md-sys-color-outline-variant) !important;
        }
        
        /* Ensure tab content is visible */
        md-primary-tab .label {
            display: inline-flex !important;
            align-items: center !important;
            gap: 8px !important;
        }
        
        /* Fallback styling for tabs if Material 3 fails */
        .material-fallback md-tabs,
        md-tabs:not(:defined),
        .material-fallback md-primary-tab,
        md-primary-tab:not(:defined) {
            display: flex !important;
            background: var(--md-sys-color-surface) !important;
            border: 1px solid var(--md-sys-color-outline-variant) !important;
            padding: 8px !important;
            margin: 4px !important;
            cursor: pointer !important;
            min-height: 40px !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 8px !important;
            font-family: 'Roboto', sans-serif !important;
            font-weight: 500 !important;
            color: var(--md-sys-color-on-surface) !important;
        }
        
        /* Text input fallback styling */
        .material-fallback md-outlined-text-field,
        md-outlined-text-field:not(:defined) {
            display: block !important;
            border: 2px solid var(--md-sys-color-outline) !important;
            padding: 12px 16px !important;
            border-radius: 4px !important;
            background: var(--md-sys-color-surface) !important;
            color: var(--md-sys-color-on-surface) !important;
            font-family: 'Roboto', sans-serif !important;
            min-height: 56px !important;
            width: 100% !important;
            box-sizing: border-box !important;
            font-size: 16px !important;
        }
        
        /* Button fallback styling */
        .material-fallback md-filled-button,
        .material-fallback md-outlined-button,
        .material-fallback md-text-button,
        md-filled-button:not(:defined),
        md-outlined-button:not(:defined),
        md-text-button:not(:defined) {
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 10px 24px !important;
            border-radius: 20px !important;
            border: none !important;
            background: var(--md-sys-color-primary) !important;
            color: var(--md-sys-color-on-primary) !important;
            font-family: 'Roboto', sans-serif !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            min-height: 40px !important;
            gap: 8px !important;
            font-size: 14px !important;
        }
        
        /* Special handling for tabs container */
        .material-fallback .app-navigation md-tabs {
            display: flex !important;
            width: 100% !important;
            background: var(--md-sys-color-surface) !important;
            border-bottom: 1px solid var(--md-sys-color-outline-variant) !important;
            margin: 0 !important;
            padding: 0 !important;
            justify-content: center !important;
            align-items: center !important;
        }
        
        /* Active tab styling */
        md-primary-tab[active],
        .material-fallback md-primary-tab[active] {
            background: var(--md-sys-color-primary-container) !important;
            color: var(--md-sys-color-on-primary-container) !important;
            border-color: var(--md-sys-color-primary) !important;
        }
        
        /* Tab hover effects */
        md-primary-tab:hover,
        .material-fallback md-primary-tab:hover {
            background: var(--md-sys-color-surface-container-high) !important;
        }
        
        /* Fix dialog visibility and positioning */
        md-dialog[open],
        md-dialog {
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 1000 !important;
            background: var(--md-sys-color-surface-container) !important;
            color: var(--md-sys-color-on-surface) !important;
            border-radius: 12px !important;
            padding: 16px !important;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3) !important;
            max-width: 400px !important;
            max-height: 70vh !important;
            width: 380px !important;
            height: auto !important;
            margin: 0 !important;
            border: none !important;
            font-size: 13px !important;
            line-height: 1.4 !important;
        }
        
        /* Hide dialogs by default */
        md-dialog:not([open]) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        /* Show dialogs when open */
        md-dialog[open] {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            flex-direction: column !important;
        }
        
        /* Dialog backdrop */
        md-dialog::backdrop {
            background: rgba(0, 0, 0, 0.5) !important;
            backdrop-filter: blur(4px) !important;
        }
        
        /* Dialog content styling */
        md-dialog [slot="headline"] {
            font-size: 18px !important;
            font-weight: 500 !important;
            margin-bottom: 12px !important;
            color: var(--md-sys-color-on-surface) !important;
            text-align: center !important;
        }
        
        md-dialog [slot="content"] {
            margin: 12px 0 !important;
            flex: 1 !important;
            font-size: 13px !important;
            line-height: 1.4 !important;
            max-height: 50vh !important;
            overflow-y: auto !important;
            padding: 0 8px !important;
        }
        
        md-dialog [slot="actions"] {
            display: flex !important;
            gap: 6px !important;
            justify-content: flex-end !important;
            margin-top: 12px !important;
            padding-top: 12px !important;
            border-top: 1px solid var(--md-sys-color-outline-variant) !important;
        }
        
        /* Settings specific styling */
        #settings-dialog .settings-section {
            margin-bottom: 14px !important;
        }
        
        #settings-dialog .settings-section h3 {
            font-size: 14px !important;
            font-weight: 500 !important;
            margin-bottom: 6px !important;
            color: var(--md-sys-color-primary) !important;
        }
        
        #settings-dialog .setting-row {
            display: flex !important;
            align-items: center !important;
            margin: 8px 0 !important;
            gap: 8px !important;
        }
        
        #settings-dialog .setting-label {
            flex: 1 !important;
            font-size: 13px !important;
            color: var(--md-sys-color-on-surface) !important;
        }
        
        #settings-dialog .setting-description {
            font-size: 11px !important;
            color: var(--md-sys-color-on-surface-variant) !important;
            margin-top: 2px !important;
            font-style: italic !important;
        }
        
        /* Settings form elements */
        #settings-dialog md-radio {
            margin-right: 8px !important;
        }
        
        #settings-dialog .radio-group {
            display: flex !important;
            flex-direction: column !important;
            gap: 8px !important;
            margin-left: 16px !important;
        }
        
        #settings-dialog .radio-option {
            display: flex !important;
            align-items: center !important;
            padding: 8px !important;
            border-radius: 8px !important;
            cursor: pointer !important;
        }
        
        #settings-dialog .radio-option:hover {
            background: var(--md-sys-color-surface-container-high) !important;
        }
        
        #settings-dialog .info-message {
            background: var(--md-sys-color-primary-container) !important;
            color: var(--md-sys-color-on-primary-container) !important;
            padding: 8px !important;
            border-radius: 6px !important;
            font-size: 12px !important;
            margin: 6px 0 !important;
        }
        
        /* Data Management Buttons */
        #settings-dialog .data-management-section {
            margin-top: 16px !important;
            padding-top: 12px !important;
            border-top: 1px solid var(--md-sys-color-outline-variant) !important;
        }
        
        #settings-dialog .data-management-buttons {
            display: flex !important;
            flex-direction: column !important;
            gap: 8px !important;
            margin-top: 8px !important;
        }
        
        #settings-dialog .data-management-buttons md-text-button {
            justify-content: flex-start !important;
            background: var(--md-sys-color-surface-container-high) !important;
            color: var(--md-sys-color-on-surface) !important;
            border: 1px solid var(--md-sys-color-outline-variant) !important;
            border-radius: 8px !important;
            padding: 8px 12px !important;
            font-size: 12px !important;
            min-height: 36px !important;
        }
        
        #settings-dialog #create-backup-btn {
            background: var(--md-sys-color-tertiary-container) !important;
            color: var(--md-sys-color-on-tertiary-container) !important;
            border-color: var(--md-sys-color-tertiary) !important;
        }
        
        #settings-dialog #view-backups-btn {
            background: var(--md-sys-color-secondary-container) !important;
            color: var(--md-sys-color-on-secondary-container) !important;
            border-color: var(--md-sys-color-secondary) !important;
        }
        
        #settings-dialog #reset-tournament-btn {
            background: var(--md-sys-color-error-container) !important;
            color: var(--md-sys-color-on-error-container) !important;
            border-color: var(--md-sys-color-error) !important;
        }
        
        #settings-dialog #new-tournament-btn {
            background: var(--md-sys-color-primary-container) !important;
            color: var(--md-sys-color-on-primary-container) !important;
            border-color: var(--md-sys-color-primary) !important;
        }
        
        #settings-dialog .data-management-buttons md-text-button:hover {
            opacity: 0.8 !important;
            transform: scale(0.98) !important;
        }
        
        /* Prevent multiple dialogs from showing */
        body:has(md-dialog[open]) md-dialog:not([open]) {
            display: none !important;
        }
        
        /* Fallback dialog styling for non-Material 3 */
        .material-fallback md-dialog,
        md-dialog:not(:defined) {
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 1000 !important;
            background: var(--md-sys-color-surface-container) !important;
            color: var(--md-sys-color-on-surface) !important;
            border-radius: 12px !important;
            padding: 24px !important;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3) !important;
            max-width: 90vw !important;
            max-height: 90vh !important;
            width: auto !important;
            height: auto !important;
            margin: 0 !important;
            border: 1px solid var(--md-sys-color-outline) !important;
            display: none !important;
        }
        
        .material-fallback md-dialog[open],
        md-dialog:not(:defined)[open] {
            display: flex !important;
            flex-direction: column !important;
        }

        /* Ensure custom element is visible and not overlapped */
        badminton-tournament-app {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
            z-index: 1 !important;
            width: 100% !important;
            min-height: 100vh !important;
        }
        
        /* Main app content should be below dialogs */
        .app-main {
            position: relative !important;
            z-index: 1 !important;
        }
        
        /* Prevent content interaction when dialogs are open */
        body:has(md-dialog[open]) .app-main {
            pointer-events: none !important;
        }
        
        body:has(md-dialog[open]) md-dialog[open] {
            pointer-events: auto !important;
        }

        /* Ensure fallback is completely hidden when not needed */
        #fallback-app {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            position: absolute !important;
            left: -9999px !important;
            z-index: -10 !important;
        }

        /* Players page specific fixes to prevent overlay issues */
        .players-page {
            position: relative !important;
            z-index: 1 !important;
            padding: 24px !important;
            max-width: 1200px !important;
            margin: 0 auto !important;
        }

        .add-player-section {
            position: relative !important;
            z-index: 1 !important;
            background: var(--md-sys-color-surface-container-low) !important;
            margin-bottom: 24px !important;
            border-radius: 16px !important;
            padding: 24px !important;
        }

        .add-player-form {
            position: relative !important;
            z-index: 1 !important;
            display: flex !important;
            gap: 16px !important;
            align-items: flex-end !important;
            flex-wrap: wrap !important;
        }
        
        /* Player list layout */
        .players-list-section {
            position: relative !important;
            z-index: 1 !important;
            background: var(--md-sys-color-surface) !important;
            border-radius: 16px !important;
            padding: 24px !important;
        }
        
        .players-list {
            display: flex !important;
            flex-direction: column !important;
            gap: 12px !important;
        }
        
        /* Player card styling */
        .player-card {
            background: var(--md-sys-color-surface-container-low) !important;
            border-radius: 12px !important;
            padding: 16px !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            border: 1px solid var(--md-sys-color-outline-variant) !important;
        }
    </style>
    
    <!-- App Styles -->
    <link rel="stylesheet" href="../src/app.css">
    <link rel="stylesheet" href="../src/pages/players/players-page.css">
    <link rel="stylesheet" href="../src/pages/rounds/rounds-page.css">
    <link rel="stylesheet" href="../src/pages/scoring/scoring-page.css">
    <link rel="stylesheet" href="../src/pages/rankings/rankings-page.css">
</head>
<body>
    <!-- Fallback HTML structure -->
    <div class="app" id="fallback-app">
        <!-- App Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="app-title">
                    <i class="material-icons app-icon">sports_tennis</i>
                    <h1 class="headline-medium">Badminton Tournament</h1>
                </div>
                <div class="header-actions">
                    <button class="icon-button" id="save-btn" title="Save Tournament">
                        <i class="material-icons">save</i>
                    </button>
                    <button class="icon-button" id="settings-btn" title="Settings">
                        <i class="material-icons">settings</i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="app-navigation">
            <div class="nav-tabs">
                <button class="nav-tab active" data-page="players">
                    <i class="material-icons">people</i>
                    Players
                </button>
                <button class="nav-tab" data-page="rounds">
                    <i class="material-icons">casino</i>
                    Rounds
                </button>
                <button class="nav-tab" data-page="scoring">
                    <i class="material-icons">emoji_events</i>
                    Scoring
                </button>
                <button class="nav-tab" data-page="rankings">
                    <i class="material-icons">leaderboard</i>
                    Rankings
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div id="players-page" class="page active">
                <div class="card">
                    <h2>Player Management</h2>
                    <p>Add and manage tournament players</p>
                    <input type="text" class="text-field" placeholder="Player name" id="player-name-input">
                    <br><br>
                    <button class="button" id="add-player-btn">Add Player</button>
                    <div id="players-list" style="margin-top: 20px;"></div>
                </div>
            </div>
            
            <div id="rounds-page" class="page">
                <div class="card">
                    <h2>Round Management</h2>
                    <p>Generate and manage tournament rounds</p>
                    <button class="button" id="generate-round-btn">Generate New Round</button>
                    <div id="rounds-list" style="margin-top: 20px;"></div>
                </div>
            </div>
            
            <div id="scoring-page" class="page">
                <div class="card">
                    <h2>Match Scoring</h2>
                    <p>Record match results</p>
                    <div id="matches-list" style="margin-top: 20px;"></div>
                </div>
            </div>
            
            <div id="rankings-page" class="page">
                <div class="card">
                    <h2>Tournament Rankings</h2>
                    <p>View current standings</p>
                    <div id="rankings-list" style="margin-top: 20px;"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Custom element will replace fallback when loaded -->
    <badminton-tournament-app style="display: none;"></badminton-tournament-app>
    
    <!-- Basic functionality script -->
    <script>
        // Version indicator - if you see this, the file is loading!
        console.log('üî•üî•üî• HTML FILE LOADED - VERSION 2.1.2-COMPACT-SETTINGS - BUILD:', new Date().toISOString());
        console.log('üîß DIALOG FIX APPLIED - All dialogs work with fallback support');
        console.log('üé® MATERIAL 3 FIX APPLIED - Smart loading with duplicate prevention');
        console.log('üêõ PLAYERS PAGE FIX APPLIED - Input validation and value access fixed');
        console.log('üéØ UI OVERLAY FIX APPLIED - Fallback hidden, z-index conflicts resolved');
        console.log('üõ°Ô∏è FALLBACK SYSTEM APPLIED - Components work even if Material 3 fails');
        console.log('üöÄ NAVIGATION FIX APPLIED - Tab navigation works with both Material 3 and fallback');
        console.log('üé™ UI POLISH APPLIED - Tab buttons centered for better appearance');
        console.log('üîß ROUNDS FIX APPLIED - Generate Round functionality now works properly');
        console.log('üèóÔ∏è LAYOUT FIX APPLIED - Proper dialog management, no more overlapping dialogs');
        console.log('‚ú® STABILITY UPGRADE - Only one dialog shows at a time, proper z-index layering');
        console.log('üéØ GENERATE FIX APPLIED - Generate Round button now has proper click handler and debug logging');
        console.log('üõ°Ô∏è ERROR PREVENTION - Added defensive checks for undefined player objects');
        console.log('‚è∞ DOM TIMING FIX - Players list now retries if DOM not ready');
        console.log('üëÅÔ∏è PLAYERS LIST FIX - Players now visible immediately on first load');
        console.log('üìê SETTINGS DIALOG FIX - Smaller size, better readability, improved typography');
        console.log('üóúÔ∏è COMPACT SETTINGS - Much smaller dialog (380px), reduced padding and margins');
        console.log('üé® DATA BUTTONS STYLED - Color-coded Data Management buttons for better readability');
        
        // Basic navigation functionality while app loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Loading fallback functionality...');
            
            const tabs = document.querySelectorAll('.nav-tab');
            const pages = document.querySelectorAll('.page');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetPage = tab.dataset.page;
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update active page
                    pages.forEach(p => p.classList.remove('active'));
                    document.getElementById(targetPage + '-page').classList.add('active');
                    
                    console.log('Switched to page:', targetPage);
                });
            });
            
            // Basic functionality placeholders
            const players = JSON.parse(localStorage.getItem('tournament-players') || '[]');
            const rounds = JSON.parse(localStorage.getItem('tournament-rounds') || '[]');
            
            function saveData() {
                localStorage.setItem('tournament-players', JSON.stringify(players));
                localStorage.setItem('tournament-rounds', JSON.stringify(rounds));
            }
            
            document.getElementById('add-player-btn')?.addEventListener('click', () => {
                const input = document.getElementById('player-name-input');
                const name = input.value.trim();
                if (name && !players.includes(name)) {
                    players.push(name);
                    input.value = '';
                    updatePlayersList();
                    saveData();
                    console.log('Added player:', name);
                }
            });
            
            function updatePlayersList() {
                const list = document.getElementById('players-list');
                list.innerHTML = players.map((player, index) => 
                    `<div style="padding: 8px; background: var(--md-sys-color-surface-container); margin: 4px 0; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
                        <span>${index + 1}. ${player}</span>
                        <button class="button button-outlined" onclick="removePlayer(${index})" style="padding: 4px 8px; font-size: 12px;">Remove</button>
                    </div>`
                ).join('');
            }
            
            window.removePlayer = (index) => {
                players.splice(index, 1);
                updatePlayersList();
                saveData();
                console.log('Removed player at index:', index);
            };
            
            document.getElementById('generate-round-btn')?.addEventListener('click', () => {
                if (players.length < 2) {
                    alert('Need at least 2 players to generate rounds');
                    return;
                }
                
                const roundNumber = rounds.length + 1;
                const matches = [];
                const shuffled = [...players].sort(() => Math.random() - 0.5);
                
                for (let i = 0; i < shuffled.length; i += 2) {
                    if (i + 1 < shuffled.length) {
                        matches.push({
                            player1: shuffled[i],
                            player2: shuffled[i + 1],
                            score1: null,
                            score2: null,
                            completed: false
                        });
                    }
                }
                
                rounds.push({ number: roundNumber, matches });
                updateRoundsList();
                saveData();
                console.log('Generated round:', roundNumber);
            });
            
            function updateRoundsList() {
                const list = document.getElementById('rounds-list');
                list.innerHTML = rounds.map(round => 
                    `<div style="padding: 12px; background: var(--md-sys-color-surface-container); margin: 8px 0; border-radius: 8px;">
                        <h3>Round ${round.number}</h3>
                        ${round.matches.map((match, idx) => 
                            `<div style="padding: 8px 0; border-bottom: 1px solid var(--md-sys-color-outline-variant);">
                                <strong>${match.player1}</strong> vs <strong>${match.player2}</strong>
                                ${match.completed ? 
                                    `<div style="margin-top: 4px; color: var(--md-sys-color-primary);">
                                        Score: ${match.score1} - ${match.score2}
                                    </div>` : 
                                    `<div style="margin-top: 4px; color: var(--md-sys-color-on-surface-variant);">
                                        Match pending
                                    </div>`
                                }
                            </div>`
                        ).join('')}
                    </div>`
                ).join('');
            }
            
            // Initialize displays
            updatePlayersList();
            updateRoundsList();
            
            console.log('‚úì Fallback interface loaded with basic functionality');
        });
    </script>

    <!-- Try to load the full application -->
    <script type="module">
        // Ensure DOM is fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadApp);
        } else {
            loadApp();
        }
        
        async function loadApp() {
            try {
                console.log('Attempting to load full application v2.0...');
                
                // Try to load main application with cache-busting timestamp
                const timestamp = Date.now();
                const appModule = await import(`../src/app.js?v=${timestamp}`);
                console.log('‚úì Main application module v2.0 loaded');
                
                // Check if custom element is properly defined and working
                const customElement = document.querySelector('badminton-tournament-app');
                if (customElement) {
                    // Wait for component to fully initialize and render content
                    let attempts = 0;
                    const maxAttempts = 50; // 5 seconds max wait
                    
                    const waitForInit = () => {
                        return new Promise((resolve, reject) => {
                            const checkInit = () => {
                                attempts++;
                                
                                // Check if the custom element has rendered its content
                                const hasContent = customElement.innerHTML && 
                                                 customElement.innerHTML.trim().length > 0 &&
                                                 customElement.querySelector('.app');
                                
                                if (hasContent) {
                                    console.log('‚úì Custom element fully initialized');
                                    resolve();
                                } else if (attempts >= maxAttempts) {
                                    console.log('‚úó Custom element failed to initialize, keeping fallback');
                                    reject(new Error('Custom element initialization timeout'));
                                } else {
                                    setTimeout(checkInit, 100);
                                }
                            };
                            checkInit();
                        });
                    };
                    
                    try {
                        await waitForInit();
                        
                        // Wait for Material 3 components to fully upgrade
                        // Check for critical Material 3 components
                        const waitForMaterialComponents = async () => {
                            const criticalComponents = [
                                'md-tabs',
                                'md-primary-tab',
                                'md-icon',
                                'md-icon-button'
                            ];
                            
                            // Wait for all critical components to be defined
                            await Promise.all(
                                criticalComponents.map(name => 
                                    customElements.whenDefined(name).catch(() => {})
                                )
                            );
                            
                            // Additional wait for components to upgrade in the DOM
                            await new Promise(resolve => setTimeout(resolve, 300));
                            
                            // Verify at least some Material components are present
                            const mdElements = customElement.querySelectorAll('[class*="md-"], md-tabs, md-icon');
                            console.log(`‚úì Found ${mdElements.length} Material 3 elements`);
                            
                            return mdElements.length > 0;
                        };
                        
                        console.log('üîß FORCING APP TO SHOW - bypassing Material checks');
                        
                        // Force show the custom element and hide fallback completely
                        const fallback = document.getElementById('fallback-app');
                        console.log('üîç Fallback element:', fallback);
                        console.log('üîç Custom element:', customElement);
                        
                        if (fallback) {
                            console.log('‚úÖ Completely hiding fallback interface');
                            fallback.style.display = 'none !important';
                            fallback.style.visibility = 'hidden';
                            fallback.style.opacity = '0';
                            fallback.style.position = 'absolute';
                            fallback.style.left = '-9999px';
                            fallback.style.zIndex = '-1';
                        }
                        
                        console.log('‚úÖ Showing custom element');
                        customElement.style.display = 'block';
                        customElement.style.visibility = 'visible';
                        customElement.style.opacity = '1';
                        customElement.style.position = 'relative';
                        customElement.style.zIndex = '1';
                        
                        // Also ensure the body doesn't have conflicting styles
                        document.body.style.overflow = 'visible';
                        
                        console.log('üéâ APP IS NOW VISIBLE!');
                    } catch (initError) {
                        console.warn('Custom element failed to initialize:', initError.message);
                        console.log('‚úì Keeping fallback interface active');
                        // Keep fallback active
                    }
                } else {
                    console.log('‚úì No custom element found, fallback interface remains active');
                }
                
            } catch (error) {
                console.warn('Could not load full application, using fallback:', error.message);
                console.log('‚úì Fallback interface will remain active');
            }
        }
    </script>
</body>
</html>