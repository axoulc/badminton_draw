<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Console - Badminton Tournament</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .debug-panel {
            background: #252526;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #3e3e42;
        }
        h2 {
            color: #4ec9b0;
            margin-top: 0;
        }
        .log {
            color: #ce9178;
            margin: 5px 0;
        }
        .success {
            color: #4ec9b0;
        }
        .error {
            color: #f48771;
        }
        .warning {
            color: #dcdcaa;
        }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1177bb;
        }
        .code {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            overflow-x: auto;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #3e3e42;
            border-radius: 8px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>üîç Debug Console - Real-Time App Analysis</h1>
    
    <div class="debug-panel">
        <h2>üìä System Status</h2>
        <div id="system-status"></div>
    </div>

    <div class="debug-panel">
        <h2>üî• Console Logs (Live)</h2>
        <div id="console-logs"></div>
    </div>

    <div class="debug-panel">
        <h2>üß™ Manual Tests</h2>
        <button onclick="testSettings()">Test Settings Dialog</button>
        <button onclick="testScoring()">Test Scoring</button>
        <button onclick="testDataEnrichment()">Test Data Enrichment</button>
        <button onclick="clearLogs()">Clear Logs</button>
        <div id="test-results" class="code"></div>
    </div>

    <div class="debug-panel">
        <h2>üì± Live App (in iframe)</h2>
        <p class="warning">‚ö†Ô∏è The app below should be fully functional. Try clicking settings or scoring.</p>
        <iframe id="app-frame" src="index.html?debug=1"></iframe>
    </div>

    <script>
        const systemStatus = document.getElementById('system-status');
        const consoleLogs = document.getElementById('console-logs');
        const testResults = document.getElementById('test-results');
        let logCount = 0;

        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addLog(type, ...args) {
            logCount++;
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleLogs.appendChild(logDiv);
            consoleLogs.scrollTop = consoleLogs.scrollHeight;
        }

        console.log = function(...args) {
            addLog('success', ...args);
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            addLog('error', '‚ùå', ...args);
            originalError.apply(console, args);
        };

        console.warn = function(...args) {
            addLog('warning', '‚ö†Ô∏è', ...args);
            originalWarn.apply(console, args);
        };

        // System status
        function updateSystemStatus() {
            systemStatus.innerHTML = `
                <div class="success">‚úÖ Debug page loaded: ${new Date().toLocaleString()}</div>
                <div class="log">üì¶ User Agent: ${navigator.userAgent}</div>
                <div class="log">üåê URL: ${location.href}</div>
                <div class="log">üìù Total logs captured: ${logCount}</div>
            `;
        }

        updateSystemStatus();
        setInterval(updateSystemStatus, 1000);

        // Test functions
        async function testSettings() {
            testResults.innerHTML = '<div class="log">Testing settings dialog...</div>';
            
            try {
                const frame = document.getElementById('app-frame');
                const frameWindow = frame.contentWindow;
                const frameDoc = frame.contentDocument;
                
                console.log('üß™ Looking for custom element in iframe...');
                const app = frameDoc.querySelector('badminton-tournament-app');
                
                if (!app) {
                    testResults.innerHTML += '<div class="error">‚ùå App element not found!</div>';
                    return;
                }
                
                console.log('‚úÖ App element found:', app);
                
                const settingsBtn = app.querySelector('#settings-btn');
                if (!settingsBtn) {
                    testResults.innerHTML += '<div class="error">‚ùå Settings button not found!</div>';
                    return;
                }
                
                console.log('‚úÖ Settings button found, clicking...');
                settingsBtn.click();
                
                setTimeout(() => {
                    const dialog = app.querySelector('#settings-dialog');
                    if (dialog) {
                        console.log('‚úÖ Settings dialog exists:', dialog);
                        console.log('Dialog open?', dialog.open, dialog.hasAttribute('open'));
                        testResults.innerHTML += `<div class="success">‚úÖ Dialog found! Open: ${dialog.open}</div>`;
                    } else {
                        console.error('‚ùå Settings dialog not found');
                        testResults.innerHTML += '<div class="error">‚ùå Dialog element not found</div>';
                    }
                }, 500);
                
            } catch (error) {
                console.error('Test error:', error);
                testResults.innerHTML += `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testScoring() {
            testResults.innerHTML = '<div class="log">Testing scoring system...</div>';
            
            try {
                const frame = document.getElementById('app-frame');
                const frameDoc = frame.contentDocument;
                const app = frameDoc.querySelector('badminton-tournament-app');
                
                if (!app) {
                    testResults.innerHTML += '<div class="error">‚ùå App not found</div>';
                    return;
                }
                
                // Switch to scoring tab
                const scoringTab = app.querySelector('[data-tab="scoring"]');
                if (scoringTab) {
                    console.log('‚úÖ Clicking scoring tab...');
                    scoringTab.click();
                    
                    setTimeout(() => {
                        const scoringPage = app.querySelector('scoring-page');
                        if (scoringPage) {
                            console.log('‚úÖ Scoring page found:', scoringPage);
                            console.log('Pending matches:', scoringPage.pendingMatches);
                            console.log('Completed matches:', scoringPage.completedMatches);
                            
                            const scoreBtn = scoringPage.querySelector('.score-btn');
                            if (scoreBtn) {
                                testResults.innerHTML += '<div class="success">‚úÖ Score button found!</div>';
                                console.log('‚úÖ Score button exists, testing click...');
                                scoreBtn.click();
                            } else {
                                testResults.innerHTML += '<div class="warning">‚ö†Ô∏è No score button (no pending matches?)</div>';
                            }
                        }
                    }, 500);
                }
            } catch (error) {
                console.error('Test error:', error);
                testResults.innerHTML += `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testDataEnrichment() {
            testResults.innerHTML = '<div class="log">Testing data enrichment...</div>';
            
            try {
                const frame = document.getElementById('app-frame');
                const frameDoc = frame.contentDocument;
                const app = frameDoc.querySelector('badminton-tournament-app');
                
                if (!app || !app.tournamentService) {
                    testResults.innerHTML += '<div class="error">‚ùå App or service not found</div>';
                    return;
                }
                
                console.log('‚úÖ Tournament service found');
                const service = app.tournamentService;
                
                const players = service.getPlayers();
                console.log('Players:', players);
                testResults.innerHTML += `<div class="log">Players count: ${players.length}</div>`;
                
                const pendingMatches = service.getPendingMatches();
                console.log('Pending matches:', pendingMatches);
                testResults.innerHTML += `<div class="log">Pending matches: ${pendingMatches.length}</div>`;
                
                if (pendingMatches.length > 0) {
                    const match = pendingMatches[0];
                    console.log('First match structure:', match);
                    testResults.innerHTML += `<div class="code">${JSON.stringify(match, null, 2)}</div>`;
                    
                    if (match.pair1 && match.pair1.player1) {
                        testResults.innerHTML += '<div class="success">‚úÖ Match data is enriched!</div>';
                    } else {
                        testResults.innerHTML += '<div class="error">‚ùå Match data NOT enriched!</div>';
                    }
                }
            } catch (error) {
                console.error('Test error:', error);
                testResults.innerHTML += `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        function clearLogs() {
            consoleLogs.innerHTML = '';
            testResults.innerHTML = '';
            logCount = 0;
            console.log('üßπ Logs cleared');
        }

        // Listen for messages from iframe
        window.addEventListener('message', (event) => {
            console.log('üì® Message from iframe:', event.data);
        });

        // Initial log
        console.log('üî• DEBUG CONSOLE INITIALIZED');
        console.log('üëâ Click the test buttons above to diagnose issues');
        console.log('üëâ Or interact with the app in the iframe below');
    </script>
</body>
</html>
